<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Solve Emacs Not Compiled With Dbus Support issue</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" href="./worg.css" type="text/css"/>
<link rel="stylesheet" href="./htmlize.css" type="text/css"/><link rel="alternate" type="application/rss+xml" title="Zhongwei Yao — Compilers, VMs & Systems Programming" href="https://zhongweiy.github.io/rss.xml"/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="H" href="index.html"> HOME </a>
 <a accesskey="A" href="about.html"> about </a>
 <a href="rss.xml"> rss </a>
</div><div id="content" class="content">
<h1 class="title">Solve Emacs Not Compiled With Dbus Support issue</h1>
<div id="outline-container-orgf359523" class="outline-2">
<h2 id="orgf359523">The error</h2>
<div class="outline-text-2" id="text-orgf359523">
<p>
When use the org-pomodora mode, emacs runs into following error:
</p>
<blockquote>
<p>
dbus-call-method: peculiar error: "Emacs not compiled with dbus support"
</p>
</blockquote>
<p>
My emacs’s version is 24.5.1 and runs on Mac OS 10.11. The error is
caused by no default dbus support on Mac OS. It may be solved by
installing dbus on Mac OS. I have not tried it. Because after take a
look at the call-stack of this error, it turns out that it could be
fixed by customize our own ‘org-show-notification’.
</p>

<div class="org-src-container">
<pre class="src src-elisp">Debugger entered--Lisp error: (dbus-error <span class="org-string">"Emacs not compiled with dbus support"</span>)
  signal(dbus-error (<span class="org-string">"Emacs not compiled with dbus support"</span>))
  dbus-call-method(<span class="org-builtin">:session</span> <span class="org-string">"org.freedesktop.Notifications"</span> <span class="org-string">"/org/freedesktop/Notifications"</span> <span class="org-string">"org.freedesktop.Notifications"</span> <span class="org-string">"Notify"</span> <span class="org-builtin">:string</span> <span class="org-string">"Emacs"</span> <span class="org-builtin">:uint32</span> 0 <span class="org-builtin">:string</span> <span class="org-string">"/Applications/Emacs.app/Contents/Resources/etc/images/icons/hicolor/scalable/apps/emacs.svg"</span> <span class="org-builtin">:string</span> <span class="org-string">"Org-mode message"</span> <span class="org-builtin">:string</span> <span class="org-string">"Task 'Network exercise R23-R26' should be finished by now. (2)"</span> (<span class="org-builtin">:array</span>) ((<span class="org-builtin">:dict-entry</span> <span class="org-string">"urgency"</span> (<span class="org-builtin">:variant</span> <span class="org-builtin">:byte</span> 0))) <span class="org-builtin">:int32</span> -1)
  byte-code(<span class="org-string">"..."</span> [params id y x transient resident plist-get <span class="org-builtin">:bus</span> <span class="org-builtin">:session</span> <span class="org-builtin">:title</span> <span class="org-builtin">:body</span> <span class="org-builtin">:app-name</span> <span class="org-builtin">:replaces-id</span> <span class="org-builtin">:app-icon</span> <span class="org-builtin">:actions</span> <span class="org-builtin">:timeout</span> nil <span class="org-builtin">:urgency</span> <span class="org-builtin">:category</span> <span class="org-builtin">:desktop-entry</span> <span class="org-builtin">:image-data</span> <span class="org-builtin">:image-path</span> <span class="org-builtin">:action-items</span> <span class="org-builtin">:sound-file</span> <span class="org-builtin">:sound-name</span> <span class="org-builtin">:suppress-sound</span> <span class="org-builtin">:resident</span> <span class="org-builtin">:transient</span> <span class="org-builtin">:x</span> <span class="org-builtin">:y</span> <span class="org-builtin">:dict-entry</span> <span class="org-string">"urgency"</span> <span class="org-builtin">:variant</span> <span class="org-builtin">:byte</span> low 0 critical 2 1 append <span class="org-string">"category"</span> <span class="org-builtin">:string</span> <span class="org-string">"desktop-entry"</span> <span class="org-string">"image-data"</span> <span class="org-builtin">:struct</span> <span class="org-string">"image-path"</span> <span class="org-string">"action-items"</span> <span class="org-builtin">:boolean</span> <span class="org-string">"sound-file"</span> <span class="org-string">"sound-name"</span> ...] 25)
  notifications-notify(<span class="org-builtin">:title</span> <span class="org-string">"Org-mode message"</span> <span class="org-builtin">:body</span> <span class="org-string">"Task 'Network exercise R23-R26' should be finished by now. (2)"</span> <span class="org-builtin">:urgency</span> low)
  org-show-notification(<span class="org-string">"Task 'Test org-pomodoro' should be finished by now. (2)"</span>)
  org-notify(<span class="org-string">"Task 'Network exercise R23-R26' should be finished by now. (2)"</span> nil)
  org-clock-notify-once-if-expired()
  org-clock-update-mode-line()
  byte-code(<span class="org-string">"..."</span> [org-clock-resolving-clocks-due-to-idleness org-clock-resolving-clocks org-clock-leftover-time leftover org--msg-extra target-pos org-clocking-p nil <span class="org-string">""</span> t org-resolve-clocks (64) org-clock-in (4) org-clock-select-task <span class="org-string">"Clock-in on task: "</span> copy-marker error <span class="org-string">"Abort"</span> (16) org-clock-mark-default-task org-back-to-heading marker-buffer marker-position 4 org-heading-components message <span class="org-string">"Clock continues in \"%s\""</span> throw abort org-clock-out org-at-heading-p point-at-bol 0 org-base-buffer run-hooks org-clock-in-prepare-hook org-clock-history-push functionp looking-at match-string 2 org-todo <span class="org-string">"[    ]*"</span> <span class="org-string">"\\&gt;"</span> replace-regexp-in-string <span class="org-string">"\\[\\[</span><span class="org-string"><span class="org-constant">.*?\\</span></span><span class="org-string">]\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\]\\]"</span> <span class="org-string">"\\1"</span> match-string-no-properties <span class="org-string">"???"</span> ...] 8)
  org-clock-in(nil)
  call-interactively(org-clock-in)
  (<span class="org-keyword">cond</span> ((equal arg (<span class="org-keyword">quote</span> (4))) (<span class="org-keyword">let</span> ((current-prefix-arg (<span class="org-keyword">quote</span> (4)))) (call-interactively (<span class="org-keyword">quote</span> org-clock-in)))) ((equal arg (<span class="org-keyword">quote</span> (16))) (call-interactively (<span class="org-keyword">quote</span> org-clock-in-last))) ((eq major-mode (<span class="org-keyword">quote</span> org-mode)) (call-interactively (<span class="org-keyword">quote</span> org-clock-in))) ((eq major-mode (<span class="org-keyword">quote</span> org-agenda-mode)) (<span class="org-keyword">let</span> ((--mpom (org-get-at-bol (<span class="org-keyword">quote</span> org-hd-marker)))) (<span class="org-keyword">save-excursion</span> (<span class="org-keyword">if</span> (markerp --mpom) (set-buffer (marker-buffer --mpom))) (<span class="org-keyword">save-excursion</span> (<span class="org-keyword">save-restriction</span> (widen) (goto-char (<span class="org-keyword">or</span> --mpom ...)) (call-interactively (<span class="org-keyword">quote</span> org-clock-in))))))) (t (<span class="org-keyword">let</span> ((current-prefix-arg (<span class="org-keyword">quote</span> (4)))) (call-interactively (<span class="org-keyword">quote</span> org-clock-in)))))
  (<span class="org-keyword">if</span> (org-pomodoro-active-p) (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not org-pomodoro-ask-upon-killing) (y-or-n-p <span class="org-string">"There is already a running timer.  Would you like to stop it? "</span>)) (org-pomodoro-kill) (message <span class="org-string">"Alright, keep up the good work!"</span>)) (<span class="org-keyword">cond</span> ((equal arg (<span class="org-keyword">quote</span> (4))) (<span class="org-keyword">let</span> ((current-prefix-arg (<span class="org-keyword">quote</span> (4)))) (call-interactively (<span class="org-keyword">quote</span> org-clock-in)))) ((equal arg (<span class="org-keyword">quote</span> (16))) (call-interactively (<span class="org-keyword">quote</span> org-clock-in-last))) ((eq major-mode (<span class="org-keyword">quote</span> org-mode)) (call-interactively (<span class="org-keyword">quote</span> org-clock-in))) ((eq major-mode (<span class="org-keyword">quote</span> org-agenda-mode)) (<span class="org-keyword">let</span> ((--mpom (org-get-at-bol (<span class="org-keyword">quote</span> org-hd-marker)))) (<span class="org-keyword">save-excursion</span> (<span class="org-keyword">if</span> (markerp --mpom) (set-buffer (marker-buffer --mpom))) (<span class="org-keyword">save-excursion</span> (<span class="org-keyword">save-restriction</span> (widen) (goto-char ...) (call-interactively ...)))))) (t (<span class="org-keyword">let</span> ((current-prefix-arg (<span class="org-keyword">quote</span> (4)))) (call-interactively (<span class="org-keyword">quote</span> org-clock-in))))) (org-pomodoro-start <span class="org-builtin">:pomodoro</span>))
  org-pomodoro(nil)
  call-interactively(org-pomodoro nil nil)
  command-execute(org-pomodoro)    
</pre>
</div>
</div>
</div>
<div id="outline-container-org8a520fa" class="outline-2">
<h2 id="org8a520fa">A solution</h2>
<div class="outline-text-2" id="text-org8a520fa">
<p>
Here are the steps:
</p>
<ol class="org-ol">
<li><p>
install terminal-notifier
</p>
<div class="org-src-container">
<pre class="src src-bash">brew install terminal-notifier
</pre>
</div></li>
<li><p>
add terminal-notifier interface to your emacs (refer):
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span class="org-comment-delimiter">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span><span class="org-comment">
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">Terminal notifier 
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">requires 'brew install terminal-notifier'
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">stolen from erc-notifier
</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">terminal-notifier-command</span> (executable-find <span class="org-string">"terminal-notifier"</span>) <span class="org-doc">"The path to terminal-notifier."</span>)

<span class="org-comment-delimiter">; </span><span class="org-comment">(terminal-notifier-notify "Emacs notification" "Something amusing happened")
</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">terminal-notifier-notify</span> (title message)
  <span class="org-doc">"Show a message with 
terminal-notifier-command
."</span>
  (start-process <span class="org-string">"terminal-notifier"</span>
                 <span class="org-string">"terminal-notifier"</span>
                 terminal-notifier-command
                 <span class="org-string">"-title"</span> title
                 <span class="org-string">"-message"</span> message
                 <span class="org-string">"-activate"</span> <span class="org-string">"org.gnu.Emacs"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">timed-notification</span> (time msg)
  (<span class="org-keyword">interactive</span> <span class="org-string">"sNotification when (e.g: 2 minutes, 60 seconds, 3 days): \nsMessage: "</span>)
  (run-at-time time nil (<span class="org-keyword">lambda</span> (msg) (terminal-notifier-notify <span class="org-string">"Emacs"</span> msg)) msg))

</pre>
</div></li>
<li><p>
customize your org-show-notification-handler
</p>
<div class="org-src-container">
<pre class="src src-elisp">(<span class="org-keyword">setq</span> org-show-notification-handler
      (<span class="org-keyword">lambda</span> (msg) (timed-notification nil msg)))
</pre>
</div></li>
</ol>
<p>
Done.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2016-02-03 Wed 00:00</p>
</div>
</body>
</html>
